{"ast":null,"code":"var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _class, _class2, _descriptor, _descriptor2, _descriptor3, _temp, _dec9, _dec10, _dec11, _dec12, _dec13, _dec14, _dec15, _dec16, _dec17, _dec18, _dec19, _dec20, _class4, _class5, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _temp2, _dec21, _dec22, _dec23, _dec24, _dec25, _dec26, _dec27, _dec28, _dec29, _dec30, _dec31, _dec32, _dec33, _dec34, _dec35, _dec36, _class7, _class8;\n\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\n\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }\n\nimport { Min, MinLength } from 'class-validator';\nimport { PantsEntity } from 'db/entity/PantsEntity';\nimport { ProductEntity } from 'db/entity/ProductEntity';\nimport { ProductType } from 'db/entity/ProductType';\nimport { Arg, Field, ID, InputType, Int, Mutation, Query, Resolver } from 'type-graphql';\nimport { getConnection, getRepository } from 'typeorm';\nimport { ShirtColor, ShirtEntity } from '../db/entity/ShirtEntity';\nimport { Pants } from './Pants';\nimport { Product } from './Product';\nimport { Shirt } from './Shirt';\nlet AddShirtInput = (_dec = InputType(), _dec2 = Field(), _dec3 = Reflect.metadata(\"design:type\", String), _dec4 = Field(() => ShirtColor), _dec5 = Reflect.metadata(\"design:type\", typeof ShirtColor === \"undefined\" ? Object : ShirtColor), _dec6 = Field(() => Int), _dec7 = Min(1), _dec8 = Reflect.metadata(\"design:type\", Number), _dec(_class = (_class2 = (_temp = class AddShirtInput {\n  constructor() {\n    _initializerDefineProperty(this, \"name\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"color\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"size\", _descriptor3, this);\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"name\", [_dec2, _dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"color\", [_dec4, _dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"size\", [_dec6, _dec7, _dec8], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nlet AddPantsInput = (_dec9 = InputType(), _dec10 = Field(), _dec11 = Reflect.metadata(\"design:type\", String), _dec12 = Field(), _dec13 = MinLength(1), _dec14 = Reflect.metadata(\"design:type\", String), _dec15 = Field(() => Int), _dec16 = Min(1), _dec17 = Reflect.metadata(\"design:type\", Number), _dec18 = Field(() => Int), _dec19 = Min(1), _dec20 = Reflect.metadata(\"design:type\", Number), _dec9(_class4 = (_class5 = (_temp2 = class AddPantsInput {\n  constructor() {\n    _initializerDefineProperty(this, \"name\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"color\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"width\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"length\", _descriptor7, this);\n  }\n\n}, _temp2), (_descriptor4 = _applyDecoratedDescriptor(_class5.prototype, \"name\", [_dec10, _dec11], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class5.prototype, \"color\", [_dec12, _dec13, _dec14], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor6 = _applyDecoratedDescriptor(_class5.prototype, \"width\", [_dec15, _dec16, _dec17], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor7 = _applyDecoratedDescriptor(_class5.prototype, \"length\", [_dec18, _dec19, _dec20], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class5)) || _class4);\nexport let ProductResolver = (_dec21 = Resolver(() => Product), _dec22 = Query(() => [Product]), _dec23 = Reflect.metadata(\"design:type\", Function), _dec24 = Reflect.metadata(\"design:paramtypes\", []), _dec25 = Mutation(() => ID), _dec26 = function (target, key) {\n  return Arg('id', () => Int)(target, key, 0);\n}, _dec27 = Reflect.metadata(\"design:type\", Function), _dec28 = Reflect.metadata(\"design:paramtypes\", [Number]), _dec29 = Mutation(() => Shirt), _dec30 = function (target, key) {\n  return Arg('data')(target, key, 0);\n}, _dec31 = Reflect.metadata(\"design:type\", Function), _dec32 = Reflect.metadata(\"design:paramtypes\", [typeof AddShirtInput === \"undefined\" ? Object : AddShirtInput]), _dec33 = Mutation(() => Pants), _dec34 = function (target, key) {\n  return Arg('data')(target, key, 0);\n}, _dec35 = Reflect.metadata(\"design:type\", Function), _dec36 = Reflect.metadata(\"design:paramtypes\", [typeof AddPantsInput === \"undefined\" ? Object : AddPantsInput]), _dec21(_class7 = (_class8 = class ProductResolver {\n  async products() {\n    const products = await getRepository(ProductEntity).find({\n      relations: ['pants', 'shirt']\n    });\n    const results = products.map(product => {\n      if (product.type === 'shirt') {\n        return {\n          id: product.id,\n          name: product.name,\n          type: product.type,\n          color: product.shirt.color,\n          size: product.shirt.size\n        };\n      } else if (product.type === 'pants') {\n        return {\n          id: product.id,\n          name: product.name,\n          type: product.type,\n          color: product.pants.color,\n          width: product.pants.width,\n          length: product.pants.length\n        };\n      } else {\n        throw new Error('Unknown product type');\n      }\n    });\n    return results;\n  }\n\n  async removeProduct(id) {\n    await getRepository(ProductEntity).delete(id);\n  }\n\n  async addShirt(shirtInput) {\n    return await getConnection().transaction(async transactionalEntityManager => {\n      const product = new ProductEntity();\n      product.name = shirtInput.name;\n      product.type = ProductType.shirt;\n      await transactionalEntityManager.save(product);\n      const shirt = new ShirtEntity();\n      shirt.id = product.id;\n      shirt.color = shirtInput.color;\n      shirt.size = shirtInput.size;\n      await transactionalEntityManager.save(shirt);\n      return {\n        id: product.id,\n        name: product.name,\n        type: ProductType.shirt,\n        color: shirt.color,\n        size: shirt.size\n      };\n    });\n  }\n\n  async addPants(pantsInput) {\n    return await getConnection().transaction(async transactionalEntityManager => {\n      const product = new ProductEntity();\n      product.name = pantsInput.name;\n      product.type = ProductType.pants;\n      await transactionalEntityManager.save(product);\n      const pants = new PantsEntity();\n      pants.id = product.id;\n      pants.color = pantsInput.color;\n      pants.width = pantsInput.width;\n      pants.length = pantsInput.length;\n      await transactionalEntityManager.save(pants);\n      return {\n        id: product.id,\n        name: product.name,\n        type: ProductType.pants,\n        color: pants.color,\n        width: pants.width,\n        length: pants.length\n      };\n    });\n  }\n\n}, (_applyDecoratedDescriptor(_class8.prototype, \"products\", [_dec22, _dec23, _dec24], Object.getOwnPropertyDescriptor(_class8.prototype, \"products\"), _class8.prototype), _applyDecoratedDescriptor(_class8.prototype, \"removeProduct\", [_dec25, _dec26, _dec27, _dec28], Object.getOwnPropertyDescriptor(_class8.prototype, \"removeProduct\"), _class8.prototype), _applyDecoratedDescriptor(_class8.prototype, \"addShirt\", [_dec29, _dec30, _dec31, _dec32], Object.getOwnPropertyDescriptor(_class8.prototype, \"addShirt\"), _class8.prototype), _applyDecoratedDescriptor(_class8.prototype, \"addPants\", [_dec33, _dec34, _dec35, _dec36], Object.getOwnPropertyDescriptor(_class8.prototype, \"addPants\"), _class8.prototype)), _class8)) || _class7);","map":{"version":3,"sources":["/Users/aleksey/Dev/Trash/shopping-cart/graphql/ProductResolver.ts"],"names":["Min","MinLength","PantsEntity","ProductEntity","ProductType","Arg","Field","ID","InputType","Int","Mutation","Query","Resolver","getConnection","getRepository","ShirtColor","ShirtEntity","Pants","Product","Shirt","AddShirtInput","AddPantsInput","ProductResolver","products","find","relations","results","map","product","type","id","name","color","shirt","size","pants","width","length","Error","removeProduct","delete","addShirt","shirtInput","transaction","transactionalEntityManager","save","addPants","pantsInput"],"mappings":"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","sourcesContent":["import { Min, MinLength } from 'class-validator';\nimport { PantsEntity } from 'db/entity/PantsEntity';\nimport { ProductEntity } from 'db/entity/ProductEntity';\nimport { ProductType, productTypes } from 'db/entity/ProductType';\nimport { Arg, Field, ID, InputType, Int, Mutation, Query, Resolver } from 'type-graphql';\nimport { getConnection, getCustomRepository, getRepository } from 'typeorm';\nimport { ShirtColor, ShirtEntity } from '../db/entity/ShirtEntity';\nimport { Pants } from './Pants';\nimport { Product } from './Product';\nimport { Shirt } from './Shirt';\n\n@InputType()\nclass AddShirtInput implements Partial<Shirt> {\n  @Field()\n  name: string;\n\n  @Field(() => ShirtColor)\n  color: ShirtColor;\n\n  @Field(() => Int)\n  @Min(1)\n  size: number;\n}\n\n@InputType()\nclass AddPantsInput implements Partial<Pants> {\n  @Field()\n  name: string;\n\n  @Field()\n  @MinLength(1)\n  color: string;\n\n  @Field(() => Int)\n  @Min(1)\n  width: number;\n\n  @Field(() => Int)\n  @Min(1)\n  length: number;\n}\n\n@Resolver(() => Product)\nexport class ProductResolver {\n  @Query(() => [Product])\n  async products(): Promise<Product[]> {\n    const products = await getRepository(ProductEntity).find({\n      relations: ['pants', 'shirt'],\n    });\n\n    const results = products.map((product) => {\n      if (product.type === 'shirt') {\n        return {\n          id: product.id,\n          name: product.name,\n          type: product.type,\n          color: product.shirt.color,\n          size: product.shirt.size,\n        };\n      } else if (product.type === 'pants') {\n        return {\n          id: product.id,\n          name: product.name,\n          type: product.type,\n          color: product.pants.color,\n          width: product.pants.width,\n          length: product.pants.length,\n        };\n      } else {\n        throw new Error('Unknown product type');\n      }\n    });\n    return results;\n  }\n\n  @Mutation(() => ID)\n  async removeProduct(@Arg('id', () => Int) id: number): Promise<void> {\n    await getRepository(ProductEntity).delete(id);\n  }\n\n  @Mutation(() => Shirt)\n  async addShirt(@Arg('data') shirtInput: AddShirtInput): Promise<Shirt> {\n    return await getConnection().transaction(async (transactionalEntityManager) => {\n      const product = new ProductEntity();\n      product.name = shirtInput.name;\n      product.type = ProductType.shirt;\n      await transactionalEntityManager.save(product);\n\n      const shirt = new ShirtEntity();\n      shirt.id = product.id;\n      shirt.color = shirtInput.color;\n      shirt.size = shirtInput.size;\n\n      await transactionalEntityManager.save(shirt);\n\n      return {\n        id: product.id,\n        name: product.name,\n        type: ProductType.shirt,\n        color: shirt.color,\n        size: shirt.size,\n      };\n    });\n  }\n\n  @Mutation(() => Pants)\n  async addPants(@Arg('data') pantsInput: AddPantsInput): Promise<Pants> {\n    return await getConnection().transaction(async (transactionalEntityManager) => {\n      const product = new ProductEntity();\n      product.name = pantsInput.name;\n      product.type = ProductType.pants;\n      await transactionalEntityManager.save(product);\n\n      const pants = new PantsEntity();\n      pants.id = product.id;\n      pants.color = pantsInput.color;\n      pants.width = pantsInput.width;\n      pants.length = pantsInput.length;\n\n      await transactionalEntityManager.save(pants);\n\n      return {\n        id: product.id,\n        name: product.name,\n        type: ProductType.pants,\n        color: pants.color,\n        width: pants.width,\n        length: pants.length,\n      };\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}